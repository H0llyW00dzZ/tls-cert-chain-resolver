{{/*
	Helper template for generating MCP tool parameters.

	This template handles the complex logic for creating MCP parameter definitions,
	including type-specific constraints, validation rules, and default values.
	It supports all MCP parameter types: string, number, boolean, array, and object.
*/}}
{{define "toolParams"}}
{{- range .}}
	{{/* Determine the MCP parameter type function */}}
	{{- $paramType := "WithObject"}}
	{{- if eq .Type "string"}}{{- $paramType = "WithString"}}
	{{- else if eq .Type "number"}}{{- $paramType = "WithNumber"}}
	{{- else if eq .Type "boolean"}}{{- $paramType = "WithBoolean"}}
	{{- else if eq .Type "array"}}{{- $paramType = "WithArray"}}
	{{- end}}

				mcp.{{$paramType}}(
				"{{.Name}}",
{{- if .Required}}
					mcp.Required(),
{{- end}}
					mcp.Description("{{.Description}}"),
{{- if .Enum}}
					mcp.Enum({{range $i, $val := .Enum}}{{if $i}}, {{end}}"{{$val}}"{{end}}),
{{- end}}
{{- if and (eq .Type "string") .MinLength}}
					mcp.MinLength({{.MinLength}}),
{{- end}}
{{- if and (eq .Type "string") .MaxLength}}
					mcp.MaxLength({{.MaxLength}}),
{{- end}}
{{- if and (eq .Type "number") .Minimum}}
					mcp.Min({{.Minimum}}),
{{- end}}
{{- if and (eq .Type "number") .Maximum}}
					mcp.Max({{.Maximum}}),
{{- end}}
{{- if and (eq .Type "string") .Pattern}}
					mcp.Pattern("{{.Pattern}}"),
{{- end}}
{{- if and (eq .Type "array") .Items}}
					mcp.Items({{.Items | toGoMap}}),
{{- end}}
{{- if and (eq .Type "object") .Properties}}
					mcp.Properties({{.Properties | toGoMap}}),
{{- end}}
{{- if and (not .Required) .Default}}
	{{- $defaultType := "DefaultBool"}}
	{{- if eq .Type "string"}}{{- $defaultType = "DefaultString"}}
	{{- else if eq .Type "number"}}{{- $defaultType = "DefaultNumber"}}
	{{- end}}
					mcp.{{$defaultType}}({{.Default}}),
{{- end}}
				),
{{- end}}
{{end}}

// Tool names as constants for consistency and type safety.
const (
{{- range .Tools}}
	// {{.ConstName}} {{.Comment}}
	{{.ConstName}} = "{{.Name}}"
{{end}}
)

// Tool roles as constants for consistency and type safety.
const (
{{- range .Tools}}
	// {{.RoleConst}} {{.RoleComment}}
	{{.RoleConst}} = "{{.RoleName}}"
{{end}}
)

// createTools creates and returns all MCP tool definitions with their handlers.
// It organizes tools into two categories: those that don't require configuration
// and those that need access to the server configuration (e.g., for AI integration or timeouts).
//
// Returns:
//   - A slice of ToolDefinition for tools without config dependencies
//   - A slice of ToolDefinitionWithConfig for tools that require server configuration
//
// The function defines the following tools:
{{- range .Tools}}
//   - {{.Name}}: {{.Description}}
{{- end}}
//
// Each tool includes proper parameter definitions, descriptions, default values,
// and MCP annotations as required by the MCP specification.
func createTools() ([]ToolDefinition, []ToolDefinitionWithConfig) {
	// Tools that don't need config
	tools := []ToolDefinition{
{{- range .Tools}}
{{- if not .WithConfig}}
		{
			Tool: mcp.NewTool(
			{{.ConstName}},
				mcp.WithDescription("{{.Description}}"),
{{- if .TitleAnnotation}}
				mcp.WithTitleAnnotation("{{.TitleAnnotation}}"),
{{- end}}
{{- if .ReadOnlyHintAnnotation}}
				mcp.WithReadOnlyHintAnnotation({{.ReadOnlyHintAnnotation}}),
{{- end}}
{{- if .DestructiveHintAnnotation}}
				mcp.WithDestructiveHintAnnotation({{.DestructiveHintAnnotation}}),
{{- end}}
{{- if .IdempotentHintAnnotation}}
				mcp.WithIdempotentHintAnnotation({{.IdempotentHintAnnotation}}),
{{- end}}
{{- if .OpenWorldHintAnnotation}}
				mcp.WithOpenWorldHintAnnotation({{.OpenWorldHintAnnotation}}),
{{- end}}
{{- template "toolParams" .Params}}
			),
			Handler: {{.Handler}},
			Role:    {{.RoleConst}},
		},
{{- end}}
{{- end}}
	}

	// Tools that need config
	toolsWithConfig := []ToolDefinitionWithConfig{
{{- range .Tools}}
{{- if .WithConfig}}
		{
			Tool: mcp.NewTool({{.ConstName}},
				mcp.WithDescription("{{.Description}}"),
{{- if .TitleAnnotation}}
				mcp.WithTitleAnnotation("{{.TitleAnnotation}}"),
{{- end}}
{{- if .ReadOnlyHintAnnotation}}
				mcp.WithReadOnlyHintAnnotation({{.ReadOnlyHintAnnotation}}),
{{- end}}
{{- if .DestructiveHintAnnotation}}
				mcp.WithDestructiveHintAnnotation({{.DestructiveHintAnnotation}}),
{{- end}}
{{- if .IdempotentHintAnnotation}}
				mcp.WithIdempotentHintAnnotation({{.IdempotentHintAnnotation}}),
{{- end}}
{{- if .OpenWorldHintAnnotation}}
				mcp.WithOpenWorldHintAnnotation({{.OpenWorldHintAnnotation}}),
{{- end}}
{{- template "toolParams" .Params}}
			),
			Handler: {{.Handler}},
			Role:    {{.RoleConst}},
		},
{{- end}}
{{- end}}
	}

	return tools, toolsWithConfig
}
