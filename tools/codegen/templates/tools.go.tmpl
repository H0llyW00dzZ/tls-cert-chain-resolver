{{/*
	toolParams helper template for generating MCP tool parameter definitions.

	This template encapsulates the complex logic for creating MCP-compliant parameter
	specifications with proper type constraints, validation rules, and default values.
	It handles all supported MCP parameter types: string, number, boolean, array, and object.

	The template processes parameter configuration data and generates appropriate
	MCP parameter builder calls with validation constraints, enum values, length limits,
	and default values as specified in the tool configuration.

	Template Parameters:
	- .Type: Parameter type (string, number, boolean, array, object)
	- .Name: Parameter name identifier
	- .Description: Human-readable parameter description
	- .Required: Boolean indicating if parameter is mandatory
	- .Enum: Optional slice of allowed values for enum constraints
	- .MinLength/MaxLength: String length constraints
	- .Minimum/Maximum: Numeric value constraints
	- .Pattern: Regular expression pattern for string validation
	- .Items: Array item type specification
	- .Properties: Object property definitions
	- .Default: Default value for optional parameters

	The generated code includes proper MCP builder method calls with all
	applicable validation constraints and type-specific configuration.
*/}}
{{define "toolParams"}}
{{- range .}}
	{{/* Determine the MCP parameter type function */}}
	{{- $paramType := "WithObject"}}
	{{- if eq .Type "string"}}{{- $paramType = "WithString"}}
	{{- else if eq .Type "number"}}{{- $paramType = "WithNumber"}}
	{{- else if eq .Type "boolean"}}{{- $paramType = "WithBoolean"}}
	{{- else if eq .Type "array"}}{{- $paramType = "WithArray"}}
	{{- end}}

				mcp.{{$paramType}}(
				"{{.Name}}",
{{- if .Required}}
					mcp.Required(),
{{- end}}
					mcp.Description("{{.Description}}"),
{{- if .Enum}}
					mcp.Enum({{range $i, $val := .Enum}}{{if $i}}, {{end}}"{{$val}}"{{end}}),
{{- end}}
{{- if and (eq .Type "string") .MinLength}}
					mcp.MinLength({{.MinLength}}),
{{- end}}
{{- if and (eq .Type "string") .MaxLength}}
					mcp.MaxLength({{.MaxLength}}),
{{- end}}
{{- if and (eq .Type "number") .Minimum}}
					mcp.Min({{.Minimum}}),
{{- end}}
{{- if and (eq .Type "number") .Maximum}}
					mcp.Max({{.Maximum}}),
{{- end}}
{{- if and (eq .Type "string") .Pattern}}
					mcp.Pattern("{{.Pattern}}"),
{{- end}}
{{- if and (eq .Type "array") .Items}}
					mcp.Items({{.Items | toGoMap}}),
{{- end}}
{{- if and (eq .Type "object") .Properties}}
					mcp.Properties({{.Properties | toGoMap}}),
{{- end}}
{{- if and (not .Required) .Default}}
	{{- $defaultType := "DefaultBool"}}
	{{- if eq .Type "string"}}{{- $defaultType = "DefaultString"}}
	{{- else if eq .Type "number"}}{{- $defaultType = "DefaultNumber"}}
	{{- end}}
					mcp.{{$defaultType}}({{.Default}}),
{{- end}}
				),
{{- end}}
{{end}}

// Tool names as constants for consistency and type safety.
const (
{{- range .Tools}}
	// {{.ConstName}} {{.Comment}}
	{{.ConstName}} = "{{.Name}}"
{{end}}
)

// Tool roles as constants for consistency and type safety.
const (
{{- range .Tools}}
	// {{.RoleConst}} {{.RoleComment}}
	{{.RoleConst}} = "{{.RoleName}}"
{{end}}
)

// createTools creates and returns all MCP tool definitions with their handlers.
// It organizes tools into two categories: those that don't require configuration
// and those that need access to the server configuration (e.g., for AI integration or timeouts).
//
// This function generates MCP-compliant tool definitions with proper parameter validation,
// type constraints, and handler bindings. Tools are categorized based on their
// configuration requirements to enable flexible server initialization.
//
// Returns:
//   - []ToolDefinition: Slice of tool definitions for tools without config dependencies
//   - []ToolDefinitionWithConfig: Slice of tool definitions for tools that require server configuration
//
// Tool Categories:
//   - Standard tools ([]ToolDefinition): {{joinTools .Tools false}}
//   - Config-dependent tools ([]ToolDefinitionWithConfig): {{joinTools .Tools true}}
//
// The function defines the following tools:
{{- range .Tools}}
//   - {{.Name}}: {{.Description}}
{{- end}}
//
// Each tool definition includes:
//   - MCP parameter specifications with type validation and constraints
//   - Comprehensive descriptions for user interface display
//   - MCP annotations for tool behavior hints (read-only, destructive, etc.)
//   - Proper handler function bindings for tool execution
func createTools() ([]ToolDefinition, []ToolDefinitionWithConfig) {
	// Tools that don't need config
	tools := []ToolDefinition{
{{- range .Tools}}
{{- if not .WithConfig}}
		{
			Tool: mcp.NewTool(
			{{.ConstName}},
				mcp.WithDescription("{{.Description}}"),
{{- if .TitleAnnotation}}
				mcp.WithTitleAnnotation("{{.TitleAnnotation}}"),
{{- end}}
{{- if .ReadOnlyHintAnnotation}}
				mcp.WithReadOnlyHintAnnotation({{.ReadOnlyHintAnnotation}}),
{{- end}}
{{- if .DestructiveHintAnnotation}}
				mcp.WithDestructiveHintAnnotation({{.DestructiveHintAnnotation}}),
{{- end}}
{{- if .IdempotentHintAnnotation}}
				mcp.WithIdempotentHintAnnotation({{.IdempotentHintAnnotation}}),
{{- end}}
{{- if .OpenWorldHintAnnotation}}
				mcp.WithOpenWorldHintAnnotation({{.OpenWorldHintAnnotation}}),
{{- end}}
{{- template "toolParams" .Params}}
			),
			Handler: {{.Handler}},
			Role:    {{.RoleConst}},
		},
{{- end}}
{{- end}}
	}

	// Tools that need config
	toolsWithConfig := []ToolDefinitionWithConfig{
{{- range .Tools}}
{{- if .WithConfig}}
		{
			Tool: mcp.NewTool(
			{{.ConstName}},
				mcp.WithDescription("{{.Description}}"),
{{- if .TitleAnnotation}}
				mcp.WithTitleAnnotation("{{.TitleAnnotation}}"),
{{- end}}
{{- if .ReadOnlyHintAnnotation}}
				mcp.WithReadOnlyHintAnnotation({{.ReadOnlyHintAnnotation}}),
{{- end}}
{{- if .DestructiveHintAnnotation}}
				mcp.WithDestructiveHintAnnotation({{.DestructiveHintAnnotation}}),
{{- end}}
{{- if .IdempotentHintAnnotation}}
				mcp.WithIdempotentHintAnnotation({{.IdempotentHintAnnotation}}),
{{- end}}
{{- if .OpenWorldHintAnnotation}}
				mcp.WithOpenWorldHintAnnotation({{.OpenWorldHintAnnotation}}),
{{- end}}
{{- template "toolParams" .Params}}
			),
			Handler: {{.Handler}},
			Role:    {{.RoleConst}},
		},
{{- end}}
{{- end}}
	}

	return tools, toolsWithConfig
}
